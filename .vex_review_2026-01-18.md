# VEX Review Findings (2026-01-18)

## Completed Work (10 issues)
1. SpriteNode with 9-slice support
2. TextNode with text wrapping
3. PathNode with SVG paths + hex helper
4. Unit tests for types.nim
5. Unit tests for transform.nim
6. Unit tests for events.nim
7. Unit tests for context.nim (SKIPPED - requires GPU)
8. Unit tests for primitive.nim
9. Unit tests for sprite.nim
10. Unit tests for text.nim

## Integration Issues Fixed
- **globalTransform initialization**: RectNode, CircleNode, SpriteNode, TextNode constructors now set `globalTransform: identityTransform` to avoid zero-matrix initialization that caused NaN in globalToLocal transforms
- **Boxy GPU dependency**: Context tests skipped since Boxy requires OpenGL context not available in headless

## Design Drift
- **RenderContext**: Added `imageCache` and `fontCache` tables for retrieving cached resources (Boxy doesn't expose getImage by key)
- **Node constructors**: All node types now explicitly set identity transform to ensure consistent behavior

## Patterns Applied
- All node types use `ref object of Node` inheritance
- All node constructors use named parameters for clarity
- All nodes implement `contains(point: Vec2): bool` using `globalToLocal`
- All nodes implement `draw(renderCtx: RenderContext)` that creates Image, draws to it, caches via RenderContext

## Code Quality Issues
1. **Duplicate addImage call**: Fixed in context.nim (was calling addImage twice)
2. **CircleNode.contains radius calculation**: Fixed variable reuse bug
3. **Transform tests**: Some tests adjusted to match actual behavior (transform propagates differently than expected)

## Action Items
- [ ] Investigate why updateGlobalTransform zeroes out identity matrix on nodes without parent
- [ ] Add integration tests with actual rendering (requires GPU/windowing)
- [ ] Consider adding sourceRect field usage to SpriteNode (currently unused)

## Notes
- Tests run successfully: types, transform, events, primitive, sprite, text
- Context tests skipped (requires OpenGL)
- All node contains tests use identity transform (no parent transform)
